{"version":3,"file":"SmartText.js","sources":["components/SmartText/SmartText.vue","../HBuilderX.4.57.2025032507/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RDovVUVEQUltaW5pcHJvZ3JhbS9jb21wb25lbnRzL1NtYXJ0VGV4dC9TbWFydFRleHQudnVl"],"sourcesContent":["<template>\r\n\t<div class=\"smart-text-container\" ref=\"container\" @mouseenter=\"showFullText\" @mouseleave=\"hideFullText\">\r\n\t\t<div class=\"smart-text-content\" :class=\"{ 'need-ellipsis': showEllipsis }\" ref=\"textContent\">\r\n\t\t\t{{ displayText }}\r\n\t\t</div>\r\n\r\n\t\t<!-- 浮窗显示完整内容 -->\r\n\t\t<transition name=\"fade\">\r\n\t\t\t<div v-show=\"isPopupVisible\" class=\"smart-text-popup\" :style=\"popupStyle\" ref=\"popup\">\r\n\t\t\t\t<div class=\"popup-content\">\r\n\t\t\t\t\t{{ text }}\r\n\t\t\t\t\t<div class=\"popup-arrow\"></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</transition>\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\n\t// 防抖处理\r\n\timport {\r\n\t\tdebounce\r\n\t} from \"lodash\";\r\n\r\n\texport default {\r\n\t\tname: \"SmartText\",\r\n\t\tprops: {\r\n\t\t\ttext: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\trequired: true,\r\n\t\t\t},\r\n\t\t\tmaxLines: {\r\n\t\t\t\ttype: Number,\r\n\t\t\t\tdefault: 2,\r\n\t\t\t},\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tshowEllipsis: false,\r\n\t\t\t\tisPopupVisible: false,\r\n\t\t\t\tcontainerWidth: 0,\r\n\t\t\t\tpopupStyle: {},\r\n\t\t\t\tresizeObserver: null,\r\n\t\t\t\tisObserving: false,\r\n\t\t\t};\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\tdisplayText() {\r\n\t\t\t\tif (!this.showEllipsis) return this.text;\r\n\t\t\t\tconst maxChars = Math.floor(this.text.length * 0.6);\r\n\t\t\t\treturn this.text.substring(0, maxChars) + \"...\";\r\n\t\t\t},\r\n\t\t},\r\n\t\tmounted() {\r\n\t\t\tthis.initTextOverflowCheck();\r\n\t\t},\r\n\t\tbeforeDestroy() {\r\n\t\t\tthis.uninstallResizeObserver();\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tinitTextOverflowCheck() {\r\n\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\tthis.checkTextOverflow();\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\tcheckTextOverflow() {\r\n\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\tconst textElement = this.$refs.textContent;\r\n\t\t\t\t\tif (!textElement) return;\r\n\r\n\t\t\t\t\t// 设置为单行不换行以检测宽度\r\n\t\t\t\t\ttextElement.style.whiteSpace = \"nowrap\";\r\n\t\t\t\t\ttextElement.style.webkitLineClamp = \"unset\";\r\n\r\n\t\t\t\t\t// 比较内容的实际宽度和容器宽度\r\n\t\t\t\t\tconst isOverflowing = textElement.scrollWidth > textElement.clientWidth;\r\n\t\t\t\t\tthis.showEllipsis = isOverflowing;\r\n\r\n\t\t\t\t\t// 恢复原始样式\r\n\t\t\t\t\ttextElement.style.whiteSpace = \"\";\r\n\t\t\t\t\ttextElement.style.webkitLineClamp = \"\";\r\n\r\n\t\t\t\t\t// 仅在需要时开启观察\r\n\t\t\t\t\tif (isOverflowing && !this.isObserving) {\r\n\t\t\t\t\t\tthis.isObserving = true;\r\n\t\t\t\t\t\tthis.setupResizeObserver();\r\n\t\t\t\t\t} else if (!isOverflowing && this.isObserving) {\r\n\t\t\t\t\t\tthis.uninstallResizeObserver();\r\n\t\t\t\t\t\tthis.isObserving = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\tshowFullText() {\r\n\t\t\t\tif (!this.showEllipsis) return;\r\n\r\n\t\t\t\tthis.isPopupVisible = true;\r\n\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\tthis.positionPopup();\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\thideFullText() {\r\n\t\t\t\tthis.isPopupVisible = false;\r\n\t\t\t},\r\n\r\n\t\t\tpositionPopup() {\r\n\t\t\t\tconst containerRect = this.$refs.container.getBoundingClientRect();\r\n\t\t\t\tconst popup = this.$refs.popup;\r\n\r\n\t\t\t\tif (!popup) return;\r\n\r\n\t\t\t\t// 计算浮窗位置（居中显示）\r\n\t\t\t\tconst popupWidth = popup.offsetWidth;\r\n\t\t\t\tconst left = containerRect.left + (containerRect.width - popupWidth) / 2;\r\n\t\t\t\tconst top = containerRect.top - popup.offsetHeight - 10;\r\n\r\n\t\t\t\tthis.popupStyle = {\r\n\t\t\t\t\tleft: `${Math.max(10, left)}px`, // 确保不超出屏幕左侧\r\n\t\t\t\t\ttop: `${Math.max(10, top)}px`, // 确保不超出屏幕上侧\r\n\t\t\t\t\tmaxWidth: `${window.innerWidth - 20}px`, // 限制最大宽度\r\n\t\t\t\t};\r\n\t\t\t},\r\n\r\n\t\t\tsetupResizeObserver() {\r\n\t\t\t\t// 使用ResizeObserver监听容器/父容器大小变化;\r\n\t\t\t\tif (typeof ResizeObserver !== \"undefined\") {\r\n\t\t\t\t\tthis.resizeObserver = new ResizeObserver(\r\n\t\t\t\t\t\tdebounce(() => {\r\n\t\t\t\t\t\t\tthis.checkTextOverflow();\r\n\t\t\t\t\t\t}, 100)\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tif (this.$refs.container) {\r\n\t\t\t\t\t\tthis.resizeObserver.observe(this.$refs.container);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// 兼容旧浏览器回退方案监听窗口resize\r\n\t\t\t\t\twindow.addEventListener(\"resize\", this.checkTextOverflow);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tuninstallResizeObserver() {\r\n\t\t\t\tif (this.resizeObserver) {\r\n\t\t\t\t\tthis.resizeObserver.disconnect();\r\n\t\t\t\t\tthis.resizeObserver = null;\r\n\t\t\t\t} else {\r\n\t\t\t\t\twindow.removeEventListener(\"resize\", this.checkTextOverflow);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t},\r\n\t\twatch: {\r\n\t\t\ttext() {\r\n\t\t\t\tthis.initTextOverflowCheck();\r\n\t\t\t},\r\n\t\t},\r\n\t};\r\n</script>\r\n\r\n<style scoped>\r\n\t.smart-text-container {\r\n\t\tposition: relative;\r\n\t\twidth: 100%;\r\n\t\tcursor: default;\r\n\t}\r\n\r\n\t.smart-text-content {\r\n\t\twhite-space: nowrap;\r\n\t\toverflow: hidden;\r\n\t\ttext-overflow: ellipsis;\r\n\t\tline-height: 1.4;\r\n\t}\r\n\r\n\t.smart-text-content.need-ellipsis {\r\n\t\tdisplay: -webkit-box;\r\n\t\t-webkit-line-clamp: 2;\r\n\t\t-webkit-box-orient: vertical;\r\n\t\twhite-space: normal;\r\n\t}\r\n\r\n\t/* 浮窗样式 */\r\n\t.smart-text-popup {\r\n\t\tposition: fixed;\r\n\t\tz-index: 9999;\r\n\t\tpadding: 8px 0;\r\n\t\twidth: 300px;\r\n\t\tpointer-events: none;\r\n\t}\r\n\r\n\t.popup-content {\r\n\t\tposition: relative;\r\n\t\tbackground: rgba(0, 0, 0, 0.85);\r\n\t\tcolor: white;\r\n\t\tpadding: 12px 16px;\r\n\t\tborder-radius: 4px;\r\n\t\tmax-width: 100%;\r\n\t\tbox-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);\r\n\t\tword-break: break-word;\r\n\t}\r\n\r\n\t.popup-arrow {\r\n\t\tposition: absolute;\r\n\t\tbottom: -6px;\r\n\t\tleft: 50%;\r\n\t\ttransform: translateX(-50%);\r\n\t\twidth: 0;\r\n\t\theight: 0;\r\n\t\tborder-left: 6px solid transparent;\r\n\t\tborder-right: 6px solid transparent;\r\n\t\tborder-top: 6px solid rgba(0, 0, 0, 0.85);\r\n\t}\r\n\r\n\t/* 过渡动画 */\r\n\t.fade-enter-active,\r\n\t.fade-leave-active {\r\n\t\ttransition: opacity 0.2s;\r\n\t}\r\n\r\n\t.fade-enter,\r\n\t.fade-leave-to {\r\n\t\topacity: 0;\r\n\t}\r\n</style>","import Component from 'D:/UEDAIminiprogram/components/SmartText/SmartText.vue'\nwx.createComponent(Component)"],"names":["debounce"],"mappings":"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"}